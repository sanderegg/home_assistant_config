- id: "1576526426710"
  alias: Turn lights in salon on when clicking the hue salon interrupteur
  description: ""
  trigger:
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: 4_click_up
  condition: []
  action:
    - entity_id: light.kitchen_lights
      service: light.turn_off

- id: switch on bathroom with motion and light
  alias: Switch light on in bathroom
  trigger:
    - entity_id: binary_sensor.bathroom_motion_sensor_sensor
      platform: state
      to: "on"
  condition:
    - below: "15"
      condition: numeric_state
      entity_id: sensor.bathroom_motion_sensor_luminance
    - condition: state
      entity_id: light.bathroom_lights
      state: "off"
  action:
    service: script.turn_on_light_based_on_night_mode
    data:
      desired_entity_id: light.bathroom_lights
      day_intensity: 255
      night_intensity: 3
- id: switch off bathroom when no motion
  alias: Switch light off in bathroom
  trigger:
    - platform: state
      entity_id: binary_sensor.bathroom_motion_sensor_sensor
      to: "off"
      for:
        minutes: 15
  condition:
    - condition: state
      entity_id: light.bathroom_lights
      state: "on"
    - condition: numeric_state
      entity_id: sensor.bathroom_motion_sensor_burglar
      below: 3
  action:
    service: homeassistant.turn_off
    data:
      entity_id: light.bathroom_lights
      transition: 3

- id: switch on entrance with motion and light
  alias: Switch light on in entrance
  trigger:
    - entity_id: binary_sensor.entrance_motion_sensor_sensor
      platform: state
      to: "on"
  condition:
    - below: "15"
      condition: numeric_state
      entity_id: sensor.entrance_motion_sensor_luminance
    - condition: state
      entity_id: light.entrance_dimmer_level
      state: "off"
    - condition: state
      entity_id: input_boolean.night_mode
      state: "off"
  action:
    service: script.turn_on_light_based_on_night_mode
    data:
      desired_entity_id: light.entrance_dimmer_level
      day_intensity: 200
      night_intensity: 0
- id: switch off entrance when no motion
  alias: Switch light off in entrance
  trigger:
    - platform: state
      entity_id: binary_sensor.entrance_motion_sensor_sensor
      to: "off"
      for:
        minutes: 5
  condition:
    - condition: state
      entity_id: light.entrance_dimmer_level
      state: "on"
    - condition: numeric_state
      entity_id: sensor.entrance_motion_sensor_burglar
      below: 3
  action:
    service: homeassistant.turn_off
    data:
      entity_id: light.entrance_dimmer_level
      transition: 3

- id: toggle nightmode
  alias: Toggle the nightmode on/off
  trigger:
    - entity_id: sensor.hue_bedroom_interrupteur
      platform: state
      to: "4_hold"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "4_hold"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "4_hold"
  action:
    service: input_boolean.toggle
    data:
      entity_id: input_boolean.night_mode

- id: switch on kitchen with motion and light
  alias: Switch light on in kitchen
  trigger:
    - entity_id: binary_sensor.kitchen_motion_sensor_sensor
      platform: state
      to: "on"
  condition:
    - condition: numeric_state
      entity_id: sensor.kitchen_motion_sensor_luminance
      below: "15"
    - condition: state
      entity_id: light.kitchen_lights
      state: "off"
  action:
    service: script.turn_on_light_based_on_night_mode
    data:
      desired_entity_id: light.kitchen_lights
      day_intensity: 255
      night_intensity: 2

- id: switch off kitchen when no motion
  alias: Switch light off in kitchen
  trigger:
    - platform: state
      entity_id: binary_sensor.kitchen_motion_sensor_sensor
      to: "off"
      for:
        minutes: 15
  condition:
    - condition: state
      entity_id: light.kitchen_lights
      state: "on"
    - condition: numeric_state
      entity_id: sensor.kitchen_motion_sensor_burglar
      below: 3
  action:
    service: homeassistant.turn_off
    data:
      entity_id: light.kitchen_lights
      transition: 5

- id: switch on kitchen lights manually
  alias: Switch on kitchen lights manually
  trigger:
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "1_click"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "1_click_up"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "1_click"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "1_click_up"
  condition:
    - condition: state
      entity_id: light.kitchen_dimmer_level
      state: "off"
  action:
    service: homeassistant.turn_on
    data:
      entity_id: light.kitchen_lights
      transition: 3

- id: switch off kitchen lights manually
  alias: Switch off kitchen lights manually
  trigger:
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "4_click"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "4_click_up"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "4_click"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "4_click_up"
  action:
    service: homeassistant.turn_off
    data:
      entity_id: light.kitchen_lights
      transition: 3

- id: level up kitchen lights manually
  alias: Level up kitchen lights manually
  trigger:
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "2_click"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "2_click_up"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "2_hold"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "2_click"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "2_click_up"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "2_hold"
  condition:
    - condition: state
      entity_id: light.kitchen_lights
      state: "on"
  action:
    service: homeassistant.turn_on
    data:
      entity_id: light.kitchen_lights
      brightness_step_pct: 10

- id: level down kitchen lights manually
  alias: Level down kitchen lights manually
  trigger:
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "3_click"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "3_click_up"
    - entity_id: sensor.hue_cuisine_interrupteur
      platform: state
      to: "3_hold"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "3_click"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "3_click_up"
    - entity_id: sensor.hue_salon_interrupteur
      platform: state
      to: "3_hold"
  condition:
    - condition: state
      entity_id: light.kitchen_lights
      state: "on"
  action:
    service: homeassistant.turn_on
    data:
      entity_id: light.kitchen_lights
      brightness_step_pct: -10

- id: switch off projector when watch film switch goes off
  alias: Switch off projector when watch film switch goes off 10 seconds
  trigger:
    platform: state
    entity_id: switch.watch_film
    to: "off"
    for:
      seconds: 10
  action:
    service: switch.turn_off
    data:
      entity_id: switch.projector_cli

- id: switch off kodi switch when watch film switch goes off
  alias: Switch off Kodi switch 5minutes after Kodi switches off
  trigger:
    platform: state
    entity_id: switch.watch_film
    to: "off"
    for:
      minutes: 5
  condition:
    condition: or
    conditions:
      - condition: state
        state: "idle"
        entity_id: media_player.spotify
      - condition: state
        state: "paused"
        entity_id: media_player.spotify
  action:
    service: switch.turn_off
    data:
      entity_id: switch.kodi_switch

- id: switch off kodi when music goes off
  alias: Switch off Kodi when music goes off
  trigger:
    - platform: state
      entity_id: media_player.spotify
      to: "off"
      for:
        minutes: 20
    - platform: state
      entity_id: media_player.spotify
      to: "idle"
      for:
        minutes: 20
    - platform: state
      entity_id: media_player.spotify
      to: "paused"
      for:
        minutes: 20
  condition:
    - condition: state
      state: "off"
      entity_id: switch.watch_film
  action:
    service: switch.turn_off
    data:
      entity_id: switch.kodi_switch

- id: feedback nightmode
  alias: Feedback on nightmode change
  trigger:
    - platform: state
      entity_id: input_boolean.night_mode
  action:
    # flash the lights
    - service: homeassistant.turn_off
      data:
        entity_id: >
          {% for light in states.light %}
            {%- if is_state(light.entity_id, 'on') %}
          - {{ light.entity_id | lower }}              
            {%- endif %}
          {%- endfor %}
        brightness: 127
    - delay: 0:01
    - service: homeassistant.turn_on
      data:
        entity_id: >
          {% for light in states.light %}
            {%- if is_state(light.entity_id, 'on') %}
          - {{ light.entity_id | lower }}              
            {%- endif %}
          {%- endfor %}
        brightness: 255

- id: disable nightmode in the morning
  alias: Disable nightmode in the morning
  trigger:
    - platform: time
      at: "07:30:00"
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.night_mode

- id: switch off pc switch when pc switches off
  alias: Switch off PC switch when PC Sylvain switches off
  trigger:
    - platform: state
      entity_id: switch.pcsylvain
      to: "off"
      for:
        minutes: 5
  action:
    service: homeassistant.turn_off
    data:
      entity_id: switch.pcs_switch

- id: switch off printer after idle time
  alias: Switch off printer when it was not used for awhile
  trigger:
    - platform: state
      entity_id: switch.printer_switch
      to: "on"
      for:
        minutes: 60
  condition:
    - condition: state
      entity_id: switch.printer_switch
      state: "on"
  action:
    service: homeassistant.turn_off
    data:
      entity_id: switch.printer_switch

- id: rpi_power_issue
  alias: Power Problem Notification
  trigger:
    - platform: numeric_state
      entity_id: sensor.rpi_power_status
      value_template: "{{ state.attributes.value }}"
      above: 0
      for:
        minutes: 5
  condition:
  action:
    - service: persistent_notification.create
      data_template:
        message: "RPI Power reported {{ states.sensor.rpi_power_status.state }}. The state had changed from {{ trigger.from_state.state }} "
        title: Power Supply Issue
    - service: notify.notify
      data_template:
        message: "RPI Power reported {{ states.sensor.rpi_power_status.state }}. The state had  changed from {{ trigger.from_state.state }}"
        title: Power Supply Issue

- id: webhook switch all lights off
  alias: Webhook switch all lights off
  trigger:
    - platform: webhook
      webhook_id: all_off
  action:
    service: scene.turn_on
    data:
      entity_id: scene.all_lights_off
